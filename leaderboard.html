
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>IngresoU — Ranking</title>
  <!-- PAGES PATCH 1755048408 -->
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;max-width:960px;margin:40px auto;padding:0 16px;color:#111}
    .card{border:1px solid #E5E7EB;border-radius:12px;padding:16px;background:#fff;margin-top:12px}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:10px;border-bottom:1px solid #F3F4F6;text-align:left;font-size:14px}
    th{font-weight:600;color:#374151}
    .mut{color:#6B7280}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;background:#EEF2FF;color:#3730A3}
  </style>
</head>
<body>
  
<header style="display:flex;justify-content:space-between;align-items:center;padding:12px 0">
  <div style="font-weight:700;font-size:20px;">IngresoU</div>
  <nav style="display:flex;gap:12px;">
    <a href="/premium.html">Mi cuenta</a>
    <a href="/leaderboard.html">Ranking</a>
  </nav>
</header>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h1 style="font-size:22px;margin:0">Ranking global</h1>
      <span id="lastUpdate" class="mut"></span>
    </div>
    <div id="status" class="mut">Cargando…</div>
    <table id="tbl" style="display:none">
      <thead><tr><th>#</th><th>Nombre</th><th>Universidad</th><th>Prueba</th><th>Puntaje</th><th>Fecha</th></tr></thead>
      <tbody id="rows"></tbody>
    </table>
  </div>

<script>
(async function(){
  const st = document.getElementById('status');
  const tbl = document.getElementById('tbl');
  const rows = document.getElementById('rows');
  document.getElementById('lastUpdate').textContent = new Date().toLocaleString('es-PA');

  let data=null;
  try{ const r=await fetch('/api/leaderboard'); if(r.ok) data=await r.json(); }catch(e){}
  if(!data){ try{ const r=await fetch('/api/scores'); if(r.ok) data=await r.json(); }catch(e){} }

  if(!Array.isArray(data)){ st.textContent='No hay datos del ranking todavía.'; return; }

  st.style.display='none'; tbl.style.display='table';
  const fmt=(d)=> new Date(d).toLocaleDateString('es-PA',{day:'2-digit',month:'2-digit',year:'numeric'});
  data.slice(0,50).forEach((it,idx)=>{
    const tr=document.createElement('tr');
    const uni = it.university || it.uni || '—';
    const nm  = it.name || it.nick || (it.email? it.email.split('@')[0] : '—');
    const test= it.topic || it.test || 'General';
    const score = (it.score !== undefined) ? it.score : (it.points !== undefined ? it.points : 0);
    const dt  = it.created_at || it.date || new Date().toISOString();
    tr.innerHTML = '<td>'+ (idx+1) +'</td><td>'+ nm +'</td><td>'+ uni +'</td><td><span class="badge">'+ test +'</span></td><td>'+ score +'</td><td>'+ fmt(dt) +'</td>';
    rows.appendChild(tr);
  });
})();
</script>
</body>
</html>
