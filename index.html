<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IngresoU ‚Äî Prep√°rate y entra a la U</title>
  <meta name="description" content="Simuladores reales para UTP y UP. Pr√°cticas, ranking global y plan de estudio. Compra con Yappy.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{ font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans'; background:#f6f7ff }
    .glass{ background:rgba(255,255,255,.8); backdrop-filter:saturate(180%) blur(8px); }
  </style>
</head>
<body class="text-gray-900">
  <header class="mx-auto max-w-6xl p-4 flex items-center justify-between">
    <div class="text-xl font-bold">Ingreso<span class="text-indigo-600">U</span></div>
    <nav class="flex items-center gap-2">
      <a href="/leaderboard.html" class="rounded-xl border px-3 py-1 text-sm">Ranking</a>
      <a href="/premium.html" class="rounded-xl border px-3 py-1 text-sm">Mi cuenta</a>
    </nav>
  </header>

  <section class="mx-auto max-w-6xl p-6 pt-4 grid lg:grid-cols-2 gap-8 items-center">
    <div>
      <h1 class="text-3xl lg:text-5xl font-extrabold leading-tight">Simuladores reales para UTP y UP</h1>
      <p class="mt-3 text-gray-700 text-lg">Practica con preguntas tipo examen, ranking global y recomendaciones. ¬°Todo en un solo lugar!</p>
      <div class="mt-5 flex flex-wrap gap-3">
        <a href="#planes" class="rounded-2xl bg-indigo-600 px-5 py-3 text-white font-semibold">Ver planes</a>
        <a href="#comprar" class="rounded-2xl bg-black px-5 py-3 text-white font-semibold">Comprar con Yappy</a>
      </div>
      <div class="mt-4 text-sm text-gray-600">Pago seguro con Yappy ¬∑ Acceso por KEY ¬∑ Soporte por WhatsApp</div>
    </div>
    <div class="glass rounded-3xl p-6 ring-1 ring-gray-200 shadow">
      <div class="text-sm text-indigo-800 font-semibold">¬øQu√© incluye?</div>
      <ul class="mt-2 space-y-2 text-gray-800">
        <li>‚Ä¢ M√≥dulos Premium: √Ålgebra, Razonamiento L√≥gico, Comprensi√≥n Lectora</li>
        <li>‚Ä¢ Simulaciones cronometradas con revisi√≥n paso a paso</li>
        <li>‚Ä¢ Ranking global y mejores marcas por m√≥dulo</li>
        <li>‚Ä¢ Acceso desde cualquier dispositivo</li>
      </ul>
      <div class="mt-4 rounded-xl bg-indigo-50 p-3 text-sm text-indigo-900">
        <b>Tip:</b> Instala la app en tu tel√©fono desde el navegador para tenerla a un toque.
      </div>
    </div>
  </section>

  <section id="planes" class="mx-auto max-w-6xl p-6">
    <h2 class="text-2xl font-bold">Planes</h2>
    <div class="mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      <div class="rounded-2xl bg-white ring-1 ring-gray-200 p-6 shadow">
        <div class="text-sm text-gray-600">B√°sico</div>
        <div class="mt-1 text-2xl font-bold">$14</div>
        <div class="text-sm text-gray-500">30 d√≠as</div>
        <ul class="mt-3 text-sm text-gray-700 space-y-1">
          <li>‚Ä¢ 3 m√≥dulos Premium</li>
          <li>‚Ä¢ Ranking global</li>
        </ul>
        <button data-plan="Basic 30d ‚Äî $14" class="buyBtn mt-4 w-full rounded-xl bg-black px-4 py-2 text-white">Comprar con Yappy</button>
      </div>
      <div class="rounded-2xl bg-white ring-2 ring-indigo-600 p-6 shadow">
        <div class="text-sm text-indigo-700">Pro</div>
        <div class="mt-1 text-2xl font-bold">$29</div>
        <div class="text-sm text-gray-500">60 d√≠as</div>
        <ul class="mt-3 text-sm text-gray-700 space-y-1">
          <li>‚Ä¢ Todo lo del B√°sico</li>
          <li>‚Ä¢ Soporte prioritario</li>
          <li>‚Ä¢ Pr√≥ximos m√≥dulos incluidos</li>
        </ul>
        <button data-plan="Pro 60d ‚Äî $29" class="buyBtn mt-4 w-full rounded-xl bg-indigo-600 px-4 py-2 text-white">Comprar con Yappy</button>
      </div>
      <div class="rounded-2xl bg-white ring-1 ring-gray-200 p-6 shadow">
        <div class="text-sm text-gray-600">Lite</div>
        <div class="mt-1 text-2xl font-bold">$9</div>
        <div class="text-sm text-gray-500">15 d√≠as</div>
        <ul class="mt-3 text-sm text-gray-700 space-y-1">
          <li>‚Ä¢ 3 m√≥dulos Premium</li>
          <li>‚Ä¢ Soporte b√°sico</li>
        </ul>
        <button data-plan="Lite 15d ‚Äî $9" class="buyBtn mt-4 w-full rounded-xl bg-black px-4 py-2 text-white">Comprar con Yappy</button>
      </div>
    </div>
  </section>

  <section id="comprar" class="mx-auto max-w-6xl p-6">
    <h2 class="text-2xl font-bold">Comprar con Yappy</h2>
    <div class="mt-3 grid gap-4 lg:grid-cols-2">
      <div class="rounded-2xl bg-white ring-1 ring-gray-200 p-6 shadow">
        <div class="text-sm text-gray-600">Paso 1</div>
        <div class="font-semibold mt-1">Paga al Yappy <span class="text-indigo-600">+507 6279-6078</span></div>
        <div class="text-sm text-gray-600">Referencia: tu correo + plan (ej: miemail@gmail.com ‚Äî Pro 60d)</div>
        <div class="text-sm text-gray-600 mt-2">Tambi√©n puedes escribirnos por WhatsApp y te guiamos.</div>
        <div class="mt-4 flex gap-2">
          <a id="whatsLink" target="_blank" class="rounded-xl bg-green-600 px-4 py-2 text-white">Abrir WhatsApp</a>
          <a href="/premium.html" class="rounded-xl border px-4 py-2">Ya tengo KEY</a>
        </div>
      </div>
      <div class="rounded-2xl bg-white ring-1 ring-gray-200 p-6 shadow">
        <div class="text-sm text-gray-600">Paso 2</div>
        <div class="font-semibold mt-1">Recibe tu KEY por correo</div>
        <p class="text-sm text-gray-600">Despu√©s del pago, te enviamos una KEY para activar tu plan. Entra a <b>Mi cuenta</b> y act√≠vala.</p>
        <div class="mt-4 rounded-xl bg-indigo-50 p-3 text-sm text-indigo-900">
          Si tienes dudas, escribe por WhatsApp. Tiempo medio de entrega: 5‚Äì10 min (horario laboral).
        </div>
      </div>
    </div>
  </section>

  <section class="mx-auto max-w-6xl p-6">
    <h2 class="text-2xl font-bold">Preguntas frecuentes</h2>
    <div class="mt-3 grid gap-3 md:grid-cols-2">
      <div class="rounded-xl bg-white ring-1 ring-gray-200 p-4">
        <div class="font-semibold">¬øQu√© universidades cubren?</div>
        <div class="text-sm text-gray-700 mt-1">UTP y UP. Seguiremos agregando m√°s.</div>
      </div>
      <div class="rounded-xl bg-white ring-1 ring-gray-200 p-4">
        <div class="font-semibold">¬øC√≥mo activo mi plan?</div>
        <div class="text-sm text-gray-700 mt-1">Con la KEY que te enviamos. Ve a <b>Mi cuenta</b> y act√≠vala.</div>
      </div>
      <div class="rounded-xl bg-white ring-1 ring-gray-200 p-4">
        <div class="font-semibold">¬øHay ranking?</div>
        <div class="text-sm text-gray-700 mt-1">S√≠. Puedes ver el Top global y tus mejores marcas.</div>
      </div>
      <div class="rounded-xl bg-white ring-1 ring-gray-200 p-4">
        <div class="font-semibold">¬øPuedo usarlo en el m√≥vil?</div>
        <div class="text-sm text-gray-700 mt-1">S√≠. Funciona en cualquier navegador moderno.</div>
      </div>
    </div>
  </section>

  <footer class="mx-auto max-w-6xl p-6 text-sm text-gray-600">
    ¬© 2025 IngresoU ‚Äî Todos los derechos reservados ¬∑
    <a href="/leaderboard.html" class="underline">Ranking</a> ¬∑
    <a href="/premium.html" class="underline">Mi cuenta</a>
  </footer>

<script>
// Construye enlace a WhatsApp con el plan seleccionado
const buyBtns = document.querySelectorAll('.buyBtn');
const whats = document.getElementById('whatsLink');
let selectedPlan = 'Pro 60d ‚Äî $29';
function updateWhats(){
  const txt = encodeURIComponent(`Hola üëã Quiero comprar IngresoU. Plan: ${selectedPlan}. Mi correo es: `);
  whats.href = `https://wa.me/50762796078?text=${txt}`;
}
buyBtns.forEach(b=> b.addEventListener('click', ()=>{ selectedPlan = b.dataset.plan; updateWhats(); window.location.hash = 'comprar'; scrollTo(0,document.getElementById('comprar').offsetTop - 20); }));
updateWhats();
</script>
  <script>
/* ===== IngresoU ‚Äì Auto-redimir KEY en el login =====
   Qu√© hace:
   - Toma KEY + email del formulario.
   - Llama a /api/get-subscription.
   - Si responde NOT_REDEEMED -> llama /api/redeem-key y reintenta.
   - Si OK -> guarda en localStorage y redirige a /premium.html.
   - Maneja EXPIRED/NOT_FOUND/EMAIL_MISMATCH con mensajes claros.
*/
(function () {
  // Ajusta si quieres forzar IDs; el script tambi√©n intenta detectar autom√°ticamente
  const SELECTORS = {
    form:   '#key-login-form, form[data-key-login], .key-login-form, form',
    key:    '#key-input, input[name=key], input[placeholder*="UTP"], input[placeholder*="UP"], input[placeholder*="KEY"]',
    email:  '#email-input, input[type=email], input[name=email], input[placeholder*="@"]',
    submit: '#login-btn, button[type=submit], button'
  };

  function $(sel, root=document){ for (const s of sel.split(',')) { const el = root.querySelector(s.trim()); if (el) return el; } return null; }
  function setStatus(msg, type='info') {
    let el = document.getElementById('key-status');
    if (!el) {
      el = document.createElement('div');
      el.id = 'key-status';
      el.style.marginTop = '8px';
      el.style.fontSize = '12px';
      const cont = $('#key-login-form') || $('form') || document.body;
      cont.appendChild(el);
    }
    const colors = {info:'#374151',ok:'#059669',warn:'#b45309',err:'#b91c1c'};
    el.style.color = colors[type] || colors.info;
    el.textContent = msg;
  }

  async function apiGetSub(code, email) {
    const r = await fetch('/api/get-subscription', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ code, email })
    });
    return r.json();
  }
  async function apiRedeem(code, email) {
    const r = await fetch('/api/redeem-key', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ code, email })
    });
    return r.json();
  }

  async function handleLogin(e) {
    e?.preventDefault?.();
    const keyEl   = $(SELECTORS.key);
    const mailEl  = $(SELECTORS.email);
    if (!keyEl || !mailEl) { setStatus('No encuentro los campos de KEY y correo.', 'err'); return; }
    const code  = (keyEl.value || '').trim().toUpperCase();
    const email = (mailEl.value || '').trim().toLowerCase();
    if (!code || !email) { setStatus('Ingresa tu KEY y tu correo.', 'warn'); return; }

    setStatus('Verificando acceso‚Ä¶');

    try {
      let res = await apiGetSub(code, email);

      // Si backend anida la suscripci√≥n, normalizamos
      const payload = res?.subscription || res;

      if (payload?.ok === false && payload?.error === 'NOT_REDEEMED') {
        setStatus('Activando tu KEY‚Ä¶');
        const r2 = await apiRedeem(code, email);
        if (r2?.ok) {
          setStatus('KEY activada. Entrando‚Ä¶', 'ok');
          res = await apiGetSub(code, email);
        } else {
          setStatus('No se pudo activar: ' + (r2?.error || 'ERROR'), 'err');
          return;
        }
      }

      // Revisamos estados comunes
      if (res?.ok === false) {
        const err = res?.error || 'ERROR';
        if (err === 'NOT_FOUND')       setStatus('La KEY no existe. Verifica que la emitiste en DB.', 'err');
        else if (err === 'EXPIRED')    setStatus('Tu KEY est√° vencida. Solicita renovaci√≥n.', 'err');
        else if (err === 'EMAIL_MISMATCH') setStatus('El correo no coincide con el de emisi√≥n. Usa el mismo correo o emite una nueva KEY.', 'err');
        else setStatus('Error: ' + err, 'err');
        return;
      }

      // Si lleg√≥ hasta aqu√≠, todo bien: guardamos y entramos
      localStorage.setItem('ingresou_key', code);
      localStorage.setItem('ingresou_email', email);
      // Si vienen datos √∫tiles, gu√°rdalos para el banner y la UI
      if (res?.university) localStorage.setItem('ingresou_university', res.university);
      if (res?.plan)       localStorage.setItem('ingresou_plan', res.plan);
      if (res?.expires_at) localStorage.setItem('ingresou_expires_at', res.expires_at);

      setStatus('Acceso verificado. Redirigiendo‚Ä¶', 'ok');
      location.href = '/premium.html';
    } catch (e) {
      console.error(e);
      setStatus('Error de red o servidor. Intenta de nuevo.', 'err');
    }
  }

  // Enlaza el handler al submit del formulario (o al bot√≥n)
  function bind() {
    const form  = $(SELECTORS.form);
    const btn   = $(SELECTORS.submit);
    if (form)  form.addEventListener('submit', handleLogin);
    if (btn)   btn.addEventListener('click', handleLogin);
  }

  document.addEventListener('DOMContentLoaded', bind);
})();
</script>

</body>
</html>
